{% extends "layout.html" %}

{% block css %}
    <link rel="stylesheet" href="{{ url_for('static', filename='css/user.css') }}">
{% endblock %}

{% block title %}个人中心{% endblock %}

{% block body %}
    <div class="banner logo-center yellowhalf"></div>
    <div class="content">
        <h2 class="ft-xl yellowBar page-title ">个人中心</h2>
        <div class="user-con">
            <div class="user-info">
                <div class="user-img">
                    <img src="{{ url_for('static', filename='image/user/default_user.png') }}">
                </div>
                <div class="text">
                    <div class="username">{{ current_user.username }}</div>
                    <div class="ft-grey">{{ time_now }}好(,,• ₃ •,,)～</div>
                </div>
                <div class="btn ft-l" id="mdfy">修改个人信息</div>
            </div>
        </div>
        <div class="user-con">
            <h3 class="title">收货地址管理</h3>
            <ul class="address-list noscroll">
                <li class="addnew pointer"></li>
                {% for address in addresses %}
                    <li address_id="{{ address.id }}">
                        <div class="name">
                            {{ address.name }}
                            <span class="hoverYellow pointer rm_address">删除</span>
                            <span class="hoverYellow pointer edit_address">编辑</span>
                        </div>
                        <ul class="detail">
                            <li>{{ address.phone_number }}</li>
                            <li>{{ address.province }}{{ address.city }}{{ address.region }}</li>
                            <li>{{ address.detail_address }}</li>
                        </ul>
                    </li>
                {% endfor %}
            </ul>
        </div>
        <div class="user-con">
            <h3 class="title">所有订单<span>待支付</span><span>待收货</span><span>已关闭</span></h3>
            <div class="user-order topay">
                <div class="head">
                    <div class="ft-xl">等待支付</div>
                    <div>
                        <span class="time">2016-05-19</span>
                        <div class="sum">
                            订单金额：<span class="ft-xl">103.60</span>
                        </div>
                        <span class="number">订单号：1887263719799100</span>
                    </div>
                </div>
                <ul class="order-list ft-m">
                    <li class="gds-con">
                        <div class="image" style="background-image: url({{ url_for('static', filename='image/goods/m1.png') }})"></div>
                        <div class="name"><b class="ellipsis">无印良品风U型抱枕</b><span>深灰白</span></div>
                        <div class="sum"><span class="price">67.70</span>x1</div>
                    </li>
                    <li class="gds-con">
                        <div class="image" style="background-image: url({{ url_for('static', filename='image/goods/m2.png') }})"></div>
                        <div class="name"><b class="ellipsis">日式单耳陶瓷碗</b><span>乳白色</span></div>
                        <div class="sum"><span class="price">26.00</span>x1</div>
                    </li>
                    <li class="gds-con">
                        <div class="image" style="background-image: url({{ url_for('static', filename='image/goods/m3.png') }})"></div>
                        <div class="name"><b class="ellipsis">创意木质手工皂盒</b><span>本木色</span></div>
                        <div class="sum"><span class="price">9.90</span>x1</div>
                    </li>
                </ul>
                <div class="user-order-btns">
                    <div class="btn pay">立即支付</div>
                    <div class="cancel pointer">取消订单</div>
                </div>
            </div>
        </div>
    </div>
    <div class="usredt-con user-mdfy popup">
        <form method="post">
            <div class="usredt-input">
                {{ user_form.username(class="username norepeat", placeholder="用户名") }}
                {{ user_form.password(class="password norepeat", placeholder="密码") }}
                {{ user_form.password2(class="password norepeat", placeholder="请重新输入密码") }}
            </div>
            {{ user_form.submit(class="btn save") }}
            <input class="btn cancel" id="cancel" value="取消">
            {{ user_form.csrf_token }}
        </form>
    </div>
    <div class="usredt-con ads-mdfy popup">
        <form method="post">
            <div class="usredt-input">
                {{ address_form.name(class="name", placeholder="姓名") }}
                {{ address_form.phone_number(class="number", placeholder="手机号") }}
                {{ address_form.province(class="province half", placeholder="省份/自治区") }}
                {{ address_form.city(class="city half", placeholder="城市/地区") }}
                {{ address_form.region(class="area", placeholder="区/县") }}
                {{ address_form.detail_address(class="location", placeholder="详细地址") }}
                {{ address_form.postcode(class="code", placeholder="邮政编码") }}
                {{ address_form.address_id(hidden=True) }}
            </div>
            {{ address_form.submit(class="btn save") }}
            <input value="取消" class="btn cancel">
            {{ address_form.csrf_token }}
        </form>
    </div>
{% endblock %}

{% block js %}
    <script src="{{ url_for('static', filename='js/addresslist.js') }}"></script>
    <script type="text/javascript">
        {% if get_flashed_messages() %}
            $(".user-mdfy").addClass("show");
            var alertBox = function(text){
                var ab = $('<div class="alert-box">'+text+'</div>');

                $(".user-mdfy.popup").append(ab);
                return function(){
                    ab.show();
                    $(".user-mdfy.popup").one("click",function(){
                        ab.hide();
                    });
                };
            };
            {% for message in get_flashed_messages() %}
                alertBox(String("{{ message }}"))();
            {% endfor %}
        {% endif %}
        $("#mdfy").on("click",function(){
            $(".user-mdfy").addClass("show");
        });
        $("#cancel").on("click",function(){
            $(".user-mdfy").removeClass("show");
        });
    </script>
{% endblock %}